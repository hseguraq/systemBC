<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Riesgo de Cáncer</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        label {
            margin-right: 10px;
        }

        select {
            margin-bottom: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Riesgo de Cáncer de Mama</h1>
        
        <!-- Dropdowns -->
        <label for="estado">Estado:</label>
        <select id="estado" onchange="cargarMunicipios()">
            <option value="">Seleccione un estado</option>
            <option value="Estado1">Estado 1</option>
            <option value="Estado2">Estado 2</option>
            <option value="Estado3">Estado 3</option>
        </select>

        <label for="municipio">Municipio:</label>
        <select id="municipio" onchange="actualizarGrafico()">
            <option value="">Seleccione un municipio</option>
        </select>


        <!-- Gráfico -->
        <canvas id="graficoRiesgo"></canvas>

    </div>

    <script>
        // Municipios según estado seleccionado
        const municipiosPorEstado = {
            "Estado1": ["Municipio1-1", "Municipio1-2", "Municipio1-3"],
            "Estado2": ["Municipio2-1", "Municipio2-2"],
            "Estado3": ["Municipio3-1", "Municipio3-2", "Municipio3-3", "Municipio3-4"]
        };

        // Datos de índice de riesgo por estado y municipio
        const riesgoPorUbicacion = {
            "Estado1": {
                "Municipio1-1": [0.40, 0.45, 0.50, 0.55],
                "Municipio1-2": [0.42, 0.48, 0.51, 0.56],
                "Municipio1-3": [0.38, 0.44, 0.49, 0.54]
            },
            "Estado2": {
                "Municipio2-1": [0.50, 0.55, 0.60, 0.65],
                "Municipio2-2": [0.52, 0.57, 0.61, 0.66]
            },
            "Estado3": {
                "Municipio3-1": [0.60, 0.62, 0.65, 0.70],
                "Municipio3-2": [0.58, 0.60, 0.63, 0.68],
                "Municipio3-3": [0.57, 0.59, 0.62, 0.67],
                "Municipio3-4": [0.55, 0.57, 0.61, 0.66]
            }
        };

        // Función para cargar municipios cuando cambia el estado
        function cargarMunicipios() {
            const estadoSeleccionado = document.getElementById('estado').value;
            const municipioSelect = document.getElementById('municipio');
            municipioSelect.innerHTML = '';

            if (estadoSeleccionado) {
                municipiosPorEstado[estadoSeleccionado].forEach(function(municipio) {
                    let option = document.createElement('option');
                    option.value = municipio;
                    option.text = municipio;
                    municipioSelect.add(option);
                });
            } else {
                let option = document.createElement('option');
                option.text = 'Seleccione un municipio';
                municipioSelect.add(option);
            }

            actualizarGrafico(); // Llamar para actualizar el gráfico después de seleccionar un nuevo estado
        }

        // Gráfico del índice de riesgo
        const ctx = document.getElementById('graficoRiesgo').getContext('2d');
        let graficoRiesgo = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['2020', '2021', '2022', '2023'], // Ejes X (años)
                datasets: [{
                    label: 'Índice de Riesgo',
                    data: [], // Inicialmente vacío, se llenará con los datos correctos
                    borderColor: 'rgba(75, 192, 192, 1)',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderWidth: 2,
                    tension: 0.3,
                    fill: true,
                    pointBackgroundColor: ['rgba(75, 192, 192, 1)', 'rgba(75, 192, 192, 1)', 'rgba(75, 192, 192, 1)', 'red'], // Cambia el color del último punto
                    pointRadius: [3, 3, 3, 5] // Aumenta el tamaño del último punto
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                },
                plugins: {
                    annotation: {
                        annotations: [{
                            type: 'line',
                            scaleID: 'x',
                            value: '2023',
                            borderColor: 'red',
                            borderWidth: 2,
                            label: {
                                content: 'Predicción',
                                enabled: true,
                                position: 'end'
                            }
                        }]
                    }
                }
            }
        });

        // Función para actualizar el gráfico con el índice de riesgo según la selección de estado y municipio
        function actualizarGrafico() {
            const estado = document.getElementById('estado').value;
            const municipio = document.getElementById('municipio').value;

            if (estado && municipio && riesgoPorUbicacion[estado] && riesgoPorUbicacion[estado][municipio]) {
                const nuevosDatos = riesgoPorUbicacion[estado][municipio];

                // Actualiza los datos del gráfico
                graficoRiesgo.data.datasets[0].data = nuevosDatos;
                graficoRiesgo.update(); // Refresca el gráfico
            }
        }
    </script>
</body>
</html>